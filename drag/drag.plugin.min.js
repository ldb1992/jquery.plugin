$(function(){var b={gpu:true,rAF:true,dragEnd:null,};var q;var u=$(document);var k=0,j=0,f=0,e=0;var i,s,l,t;var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,g=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame,m;function p(){var v;console.info("--------------drag target is--------------");console.info(q[0]);v=q.css("position");if(v==="static"||v==="relative"){q.css("position","absolute");console.warn("--------------position is not correctly configured,and is now set to absolute--------------");}console.info("--------------offsetParent is--------------");console.info((offsetParent=q.offsetParent())[0]);return d();}function a(v){f=v.clientX-k;e=v.clientY-j;console.log(">>>>>>>>>start drag,and clickPos is:",v.clientX,v.clientY);u.on({mousemove:r,mouseup:n});if(b.rAF){console.log("--------------use requestAnimationFrame move--------------");h();return;}console.log("--------------no requestAnimationFrame move--------------");}function r(v){k=v.clientX-f;j=v.clientY-e;if(!b.rAF){o();}return;}function o(){d();if(b.gpu){q.css({"-webkit-transform":"translate3D("+k+"px,"+j+"px,0px)",left:0,top:0});console.log("--------------use gpu move--------------");}else{q.css({left:k,top:j});console.log("--------------no gpu move--------------");}}function h(){o();m=c(h);}function n(v){u.off("mousemove");u.off("mouseup");if(b.gpu){d();q.hide();q.css({"-webkit-transform":"translate3D(0px,0px,0px)",left:k,top:j});q.show();}if(b.rAF){g(m);}if(b.dragEnd){b.dragEnd();}console.log(">>>>>>>>>end drag,and elemPos is:",k,j);}function d(){var v=false;i=i||offsetParent.width();s=s||offsetParent.height();l=l||q.width();t=t||q.height();if(l>i||t>s){console.log("wrapper is:",i,s,"elem is:",l,t);console.error("--------------wrapper is too small--------------");v=true;}if(k+l>i){k=i-l;v=true;}if(k<0){k=0;v=true;}if(j+t>s){j=s-t;v=true;}if(j<0){j=0;v=true;}return v;}$.extend($.fn,{drag:function(v){q=$(this);if(p()){return;}if(!$.isPlainObject(v)){console.error("--------------conf wrong--------------");return;}$.extend(b,v);console.log(JSON.stringify(b));q.on("mousedown",a);}});});